{% extends "dashboard.html" %}

{% block input %}
<div class="flex items-center gap-2 mb-1">
    <textarea id="input"
        class="p-3 px-4 text-lg border-2 resize-none w-52 textarea h-14 hover:resize textarea-bordered textarea-primary"
        name="todo_title" role="textbox" contenteditable placeholder="Title" autocomplete="off" autofocus></textarea>
    <button id="button" onclick="clearAndGrab()" class="btn btn-primary btn-sm">
        +
    </button>
    <span class="relative htmx-indicator -right-2 loading loading-spinner loading-lg"></span>
</div>

<script>
    const input = document.getElementById("input")
    input.addEventListener('input', (event) => {
        if (!event.target.value) {
            document.getElementById('button').disabled = true;
        } else {
            document.getElementById('button').disabled = false;
        }
    });
    input.addEventListener('focus', (event) => {
        if (!event.target.value) {
            document.getElementById('button').disabled = true;
        } else {
            document.getElementById('button').disabled = false;
        }
    });

    function clearAndGrab() {
        setTimeout(() => {
            const input = document.querySelector('#input');
            input.value = "";
            input.focus();
        }, 1)
    }

    input.addEventListener("keypress", function (e) {
        if (e.which === 13) {
            if (!e.shiftKey) {
                e.preventDefault();
                var newEvent = document.createEvent("Event");
                newEvent.initEvent("submit", false, true);
                event.target.form.dispatchEvent(newEvent);
                clearAndGrab()
            }
        }
    });
</script>
{% endblock %}